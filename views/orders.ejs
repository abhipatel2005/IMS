<%- include('partials/header.ejs') %>
  <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div
      class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
      <h2 class="h2">Orders</h2>
    </div>

    <div class="btn-group mb-4">
      <a href="/get_data/data" class="btn btn-light">All</a>
      <a href="/approved_orders" class="btn btn-light">Accepted</a>
      <a href="/pending_orders" class="btn btn-light">Pending</a>
    </div>

    <% if (locals.count> 0) { %>
      <div class="table-responsive small">
        <h5 class="h5 mb-3">Total Orders: <%= count %>
        </h5>
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th>Name</th>
              <th>Product ID</th>
              <th>Category</th>
              <th>Specification</th>
              <th>Department</th>
              <% if (locals.role) { %>
                <th>Actions</th>
                <% } else { %>
                  <th>Status</th>
                  <% } %>
            </tr>
          </thead>
          <tbody>
            <% (data || []).forEach(item=> { %>
              <tr>
                <td>
                  <%= item.product_name %>
                </td>
                <td>
                  <%= item.product_key %>
                </td>
                <td>
                  <%= item.category %>
                </td>
                <td>
                  <%= item.specification %>
                </td>
                <td>
                  <%= item.department %>
                </td>
                <% if (locals.role) { %>
                  <td>
                    <form method="POST" action="/approve_product/<%= item._id %>" style="display:inline;">
                      <button type="submit" class="btn btn-success btn-sm">Accept</button>
                    </form>
                    <form method="POST" action="/decline_product/<%= item._id %>" style="display:inline;">
                      <button type="submit" class="btn btn-danger btn-sm">Decline</button>
                    </form>
                  </td>
                  <% } else { %>
                    <td>
                      <% if (item.isApproved) { %>
                        <span class="btn btn-success btn-sm">Accepted</span>
                        <% } else { %>
                          <div class="box">
                            <span class="btn btn-danger btn-sm">Pending</span>
                            <a href="/remove/<%= item._id %>" class="btn btn-outline-danger btn-sm show-hide">
                              <i class="bi bi-trash3"></i>
                            </a>
                          </div>
                          <% } %>
                    </td>
                    <% } %>
              </tr>
              <% }); %>
                <% if (!(data || []).length) { %>
                  <tr>
                    <td colspan="6">No Pending Orders</td>
                  </tr>
                  <% } %>
          </tbody>
        </table>
      </div>
      <% }%>

        <% if (locals.approvedData || locals.pendingData) { %>
          <div class="table-responsive small">
            <% if(locals.approvedData){ %>
              <h5 class="h5 mb-3">Approved Orders: <%= noApprovedOrders %>
                  <%} else {%>
                    <h5 class="h5 mb-3">Pending Orders: <%= noPendingOrders %>
                        <%}%>
                    </h5>
                    <table class="table table-striped table-sm">
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Product ID</th>
                          <th>Category</th>
                          <th>Specification</th>
                          <th>Department</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% (locals.approvedData || locals.pendingData).forEach(item=> { %>
                          <tr>
                            <td>
                              <%= item.product_name %>
                            </td>
                            <td>
                              <%= item.product_key %>
                            </td>
                            <td>
                              <%= item.category %>
                            </td>
                            <td>
                              <%= item.specification %>
                            </td>
                            <td>
                              <%= item.department %>
                            </td>
                          </tr>
                          <% }); %>
                      </tbody>
                    </table>
          </div>
          <% } else {%>
            <h5>Nothing to show! ðŸ˜†</h5>
            <%} %>
  </main>

  <script>
    document.querySelectorAll('.box').forEach((box, index) => {
      const showHideButton = box.querySelector('.show-hide');
      showHideButton.style.visibility = 'hidden';

      box.addEventListener('mouseover', () => {
        showHideButton.style.visibility = 'visible';
      });

      box.addEventListener('mouseout', () => {
        showHideButton.style.visibility = 'hidden';
      });
    });
  </script>
  <script src="/assets/theme.js"></script>
  </body>

  </html>