<%- include('partials/header.ejs') %>
  <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div
      class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
      <h2 class="h2">Orders</h2>
    </div>

    <% if (locals.count !==undefined && locals.count> 0) { %>
      <div class="table-responsive small">
        <h5 class="h5">
          Pending Orders: <% if (locals.count !==undefined && locals.count> 0) { %><%= count %>
              <% } %>
        </h5>
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Product ID</th>
              <th scope="col">Category</th>
              <th scope="col">Specification</th>
              <th scope="col">Department</th>
              <% if (locals.role) { %>
                <th scope="col">Actions</th>
                <% } else { %>
                  <th scope="col">Status</th>
                  <% } %>
            </tr>
          </thead>
          <tbody>
            <% if (locals.data) { %>
              <% data.forEach(item=> { %>
                <tr>
                  <td>
                    <%= item.product_name %>
                  </td>
                  <td>
                    <%= item.product_key %>
                  </td>
                  <td>
                    <%= item.category %>
                  </td>
                  <td>
                    <%= item.specification %>
                  </td>
                  <td>
                    <%= item.department %>
                  </td>
                  <% if (locals.role) { %>
                    <td class="d-flex">
                      <form method="POST" action="/approve_product/<%= item._id %>">
                        <button type="submit" class="btn btn-success btn-sm me-2">Accept</button>
                      </form>
                      <form method="POST" action="/decline_product/<%= item._id %>">
                        <button type="submit" class="btn btn-danger btn-sm">Decline</button>
                      </form>
                    </td>
                    <% } else { %>
                      <td>
                        <% if (item.isApproved) { %>
                          <span class="btn btn-success btn-sm">Accepted</span>
                          <% } else { %>
                            <div class="box">
                              <span class="btn btn-danger btn-sm">Pending</span>
                              <a class="btn btn-sm btn-outline-danger show-hide" href="/remove/<%= item._id %>">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                  class="bi bi-trash3" viewBox="0 0 16 16">
                                  <path
                                    d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
                                </svg>
                              </a>
                            </div>
                            <% } %>
                      </td>
                      <% } %>
                </tr>
                <% }); %>
                  <% } %>
          </tbody>
        </table>
      </div>
      <% } else { %>
        <h5 class="h5">No Pending Orders</h5>
        <br>
        <% } %>

          <% if (locals.role) { %>
            <div class="table-responsive small">
              <h5 class="h5">
                Total Orders: <% if (locals.countForApprovedData !==undefined && locals.countForApprovedData> 0) { %><%=
                    countForApprovedData %>
                    <% } else { %> No Orders <% } %>
              </h5>
              <table class="table table-striped table-sm">
                <thead>
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Product ID</th>
                    <th scope="col">Category</th>
                    <th scope="col">Specification</th>
                    <th scope="col">Department</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (locals.approvedData) { %>
                    <% approvedData.forEach(item=> { %>
                      <tr>
                        <td>
                          <%= item.product_name %>
                        </td>
                        <td>
                          <%= item.product_key %>
                        </td>
                        <td>
                          <%= item.category %>
                        </td>
                        <td>
                          <%= item.specification %>
                        </td>
                        <td>
                          <%= item.department %>
                        </td>
                      </tr>
                      <% }); %>
                        <% } %>
                </tbody>
              </table>
            </div>
            <% } %>
  </main>

  <script>
    let hover = document.querySelectorAll('.box');
    let show_hide = document.querySelectorAll('.show-hide');
    for (let i = 0; i < hover.length; i++) {
      show_hide[i].style.visibility = 'hidden';
      hover[i].addEventListener('mouseover', () => {
        show_hide[i].style.visibility = 'visible';
      });
      hover[i].addEventListener('mouseout', () => {
        show_hide[i].style.visibility = 'hidden';
      });
    }
  </script>

  <script src="/assets/theme.js"></script>
  </body>

  </html>